---
output:
  html_document:
    toc: yes
  pdf_document:
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
  warning = FALSE
)
library("psych", lib.loc = "~/R/win-library/3.3")
library("zoom", lib.loc = "~/R/win-library/3.3")
library("knitr", lib.loc = "~/R/win-library/3.3")
setwd("C:/Users/Markus/Sync/Bachelor/exst_clasp/Experiments")

```

```{r load data, echo=FALSE, message=FALSE, warning=FALSE}

Statistics <-
  read.csv(
    file = "Statistics.csv",
    header = TRUE,
    sep = ",",
    quote = "\"",
    dec = "."
  )
stat <- Statistics[, -40:-69]
stat <- stat[, -2]
problems <- unique(stat[, 1])

```

```{r Overall Summary, echo=FALSE, message=FALSE, warning=FALSE}

oSummary = matrix(nrow = 0, ncol = 5)

for (col in 2:length(colnames(stat))) {
    oSummary <-
      rbind(oSummary, c(
      colnames(stat)[col],
      min(stat[, col], na.rm = TRUE),
      max(stat[, col], na.rm = TRUE),
      mean(stat[, col], na.rm = TRUE),
      median(stat[, col], na.rm = TRUE)
      ))
}

```

```{r Summary per problem, echo=FALSE, message=FALSE, warning=FALSE}

su = matrix(nrow = 0, ncol = 6)
overview = matrix(nrow = 0, ncol = 2)

for (pro in problems) {
  st <- stat[stat$problem == pro, ]
  overview <- rbind(overview, c(pro, length(st[, 1])))
  for (col in 2:length(colnames(stat))) {
    su <-
      rbind(su, c(
        pro,
        colnames(stat)[col],
        min(st[, col], na.rm = TRUE),
        max(st[, col], na.rm = TRUE),
        mean(st[, col], na.rm = TRUE),
        median(st[, col], na.rm = TRUE)
      ))
  }
}

```

```{r Summary per problem2, echo=FALSE, message=FALSE, warning=FALSE}

asdf = matrix(nrow = 0, ncol = (length(unique(stat[, 1]))+2))

for (col in 2:length(colnames(stat))) {
  st <- stat[stat$problem == pro,]
  minrow <- c(colnames(stat)[col], "min")
  maxrow <- c(colnames(stat)[col], "max")
  meanrow <- c(colnames(stat)[col], "mean")
  medianrow <-  c(colnames(stat)[col], "median")
  for (pro in unique(stat[, 1])) {
    st <- stat[stat$problem == pro,]
    minrow <- c(minrow, min(st[, col], na.rm = TRUE))
    maxrow <- c(maxrow, max(st[, col], na.rm = TRUE))
    meanrow <- c(meanrow, mean(st[, col], na.rm = TRUE))
    medianrow <-  c(medianrow, median(st[, col], na.rm = TRUE))
  }
  asdf <- rbind(asdf, minrow)
  asdf <- rbind(asdf, maxrow)
  asdf <- rbind(asdf, meanrow)
  asdf <- rbind(asdf, medianrow)
}

```

# Correlations

```{r correlations, echo=FALSE, message=FALSE, warning=FALSE}

a <- corr.test(stat[, -1], adjust = "none")
corelation <- round(a$r, 2)
list_cor = matrix(nrow = 0, ncol = 3)
for (a in 1:length(corelation[, 1])) {
  for (b in 1:length(corelation[, 1])) {
    if (!is.na(corelation[a, b])) {
      if ((a < b)) {
        list_cor <-
          rbind(list_cor, c(
            row.names(corelation)[a],
            colnames(corelation)[b],
            corelation[a, b]
          ))
      }
    }
  }
}

```

##Correlation per Problem

```{r correlations per problem, echo=FALSE, message=FALSE, warning=FALSE,results='asis'}
begin <- TRUE
count <- 2
for (pro in unique(stat[, 1])) {
  st <- stat[stat$problem == pro, ]
  lenst <- sum(!is.na(st[, 1]))
  if (lenst > 10) {
    a <- corr.test(st[,-1], adjust = "none")
    if (begin) {
      correlations <- list(round(a$r, 2))
      problems <- list(pro)
      begin <- FALSE
    } else{
      correlations[[count]] <- round(a$r, 2)
      problems[[count]] <- pro
      count <- count + 1
    }
  }
}

```

```{r correlations per problem stat, echo=FALSE, message=FALSE, warning=FALSE,results='asis'}

len <- length(colnames(correlations[[1]]))
minmatrix <- matrix(nrow=len,ncol=len)
maxmatrix <- matrix(nrow=len,ncol=len)
corrmatrix <- matrix(nrow=len^2,ncol=10)
begin <- TRUE
count <- 2
for (stat1 in 1:len) {
  for (stat2 in 1:len) {
    begin <- TRUE
    for (prob in 1:length(problems)) {
      if(!is.na(correlations[[prob]][stat1, stat2])){
      if (begin) {
        cors <- c(correlations[[prob]][stat1, stat2])
        begin <- FALSE
      } else{
        cors <- c(cors, correlations[[prob]][stat1, stat2])
      }}
    }
    corrmatrix[(stat1-1) * (len) + stat2, 1] <- colnames(correlations[[1]])[stat1]
    corrmatrix[(stat1-1) * (len) + stat2, 2] <- colnames(correlations[[1]])[stat2]
    corrmatrix[(stat1-1) * (len) + stat2, 3] <- min(cors, na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 4] <- max(cors, na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 5] <- mean(cors, na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 6] <- median(cors, na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 7] <- min(abs(cors), na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 8] <- max(abs(cors), na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 9] <- mean(abs(cors), na.rm = TRUE)
    corrmatrix[(stat1-1) * (len) + stat2, 10] <- median(abs(cors), na.rm = TRUE)
    minmatrix[stat1,stat2] <- min(abs(cors), na.rm = TRUE)
    maxmatrix[stat1,stat2] <- max(abs(cors), na.rm = TRUE)
  }
}
kable(corrmatrix,col.names = c("Statistic","Statistic","min","max","mean","median","absolute min","absolute max","absolute mean","absolute median"))

```

#Plots for corrlation with hight difference

```{r correlations per problem with plots, echo=FALSE, message=FALSE, warning=FALSE,results='asis'}

maxlen <- max(nchar(problems))
for(a in 1:len) {
  for (b in 1:len) {
    if (minmatrix[a, b] <= 0.4 && maxmatrix >= 0.6) {
      num <- 1
      cat(sprintf(
        "\n\n## Statistic: %s vs. %s \n\n",
        colnames(st)[a + 1],
        colnames(st)[b + 1]
      ))
      for (pro in problems) {
        lenst <- sum(!is.na(st[, 1]))
        if (lenst > 10) {
          st <- stat[stat$problem == pro,]
          if (!is.na(max(st[, a + 1])) &&
              !is.na(max(st[, b + 1])) &&
              !is.na(min(st[, a + 1])) &&
              !is.na(min(st[, b + 1])) &&
              !is.na(correlations[[num]][a, b])) {
            cat(sprintf(
              "\n\n### %s%s Correlation: %s\n\n",
              pro,
              paste(replicate(maxlen - nchar(pro), " "), collapse = ""),
              correlations[[num]][a, b]
            ))
            print(
              plot(
                x = st[, b + 1],
                y = st[, a + 1],
                xlab = colnames(st)[b + 1],
                ylab = colnames(st)[a + 1],
                xlim = c(min(st[, b + 1]), max(st[, b + 1])),
                ylim = c(min(st[, a + 1]), max(st[, a + 1])),
                pch = "x"
              )
            )
            
          }
        }
        num <- num + 1
      }
      
    }
  }
}

```